<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2184: Muddled allocator requirements for match_results assignments</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<p><em>This page is a snapshot from the LWG issues list, see the <a href="lwg-active.html">Library Active Issues List</a> for more information and the meaning of <a href="lwg-active.html#New">New</a> status.</em></p>
<h3><a name="2184" href="lwg-active.html#2184">2184</a>. Muddled allocator requirements for <tt>match_results</tt> assignments</h3>
<p><b>Section:</b> 31.10.1 <a href="https://wg21.link/re.results.const">[re.results.const]</a>, 31.10.6 <a href="https://wg21.link/re.results.all">[re.results.all]</a> <b>Status:</b> <a href="lwg-active.html#New">New</a>
 <b>Submitter:</b> Pete Becker <b>Opened:</b> 2012-08-29 <b>Last modified:</b> 2018-06-03</p>
<p><b>Priority: </b>3
</p>
<p><b>View other</b> <a href="lwg-index-open.html#re.results.const">active issues</a> in [re.results.const].</p>
<p><b>View all other</b> <a href="lwg-index.html#re.results.const">issues</a> in [re.results.const].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#New">New</a> status.</p>
<p><b>Discussion:</b></p>

<p>
The effects of the two assignment operators are specified in Table 141. Table 141 makes no mention of allocators, 
so, presumably, they don't touch the target object's allocator. That's okay, but it leaves the question: 
<tt>match_results::get_allocator()</tt> is supposed to return "A copy of the Allocator that was passed to the 
object's constructor or, if that allocator has been replaced, a copy of the most recent replacement"; if assignment 
doesn't replace the allocator, how can the allocator be replaced?
</p>

<p><i>[2018-06-03, Daniel comments and provides wording]</i></p>

<p>
Similar to the 2018-06-02 comment of LWG <a href="lwg-active.html#2183">2183</a> we can refer to 31.10 <a href="https://wg21.link/re.results">[re.results]</a> p2:
</p>
<blockquote><p>
The class template <tt>match_results</tt> satisfies the requirements of an allocator-aware container and of a sequence
container (26.2.1, 26.2.3) except that only operations defined for const-qualified sequence containers are
supported and that the semantics of comparison functions are different from those required for a container.
</p></blockquote>
<p>
As explained in said comment, 26.2.1 <a href="https://wg21.link/container.requirements.general">[container.requirements.general]</a> p8 specifies the allocator semantics
also for <tt>match_results</tt>, in this case the wording that species it is given by this part:
</p>
<blockquote><p>
[&hellip;] The allocator may be replaced only via assignment or <tt>swap()</tt>. Allocator replacement is 
performed by copy assignment, move assignment, or swapping of the allocator only if 
<tt>allocator_traits&lt;allocator_type&gt;::propagate_on_container_copy_assignment::value</tt>,
<tt>allocator_traits&lt;allocator_type&gt;::propagate_on_container_move_assignment::value</tt>, or 
<tt>allocator_traits&lt;allocator_type&gt;::propagate_on_container_swap::value</tt> is <tt>true</tt> within 
the implementation of the corresponding container operation. [&hellip;]
</p></blockquote>
<p>
There is only one problem here that prevents the current wording state to answer the questions raised by 
this issue here: 31.10 <a href="https://wg21.link/re.results">[re.results]</a> p2 specifically constraints the specification in terms of 
allocator-aware container and of a sequence container requirements as follows: "except that only operations 
defined for const-qualified sequence containers are supported", but the discussed copy-assignment and 
move-assignment operators are clearly not operations allowed for a const-qualified container. Before providing
concrete wording the committee should answer the question whether the intention of <tt>match_results</tt>'s
specification was to support copy/move-assignment allocator-related semantics still to be defined by
26.2.1 <a href="https://wg21.link/container.requirements.general">[container.requirements.general]</a> and 26.2.3 <a href="https://wg21.link/sequence.reqmts">[sequence.reqmts]</a>. If so, the wording of
31.10 <a href="https://wg21.link/re.results">[re.results]</a> p2 could be updated to ensure that these assignments are specified as well, e.g. 
as follows:
</p>
<blockquote><p>
The class template <tt>match_results</tt> satisfies the requirements of an allocator-aware container and 
of a sequence container (26.2.1, 26.2.3) except that <ins>besides copy and move assignment</ins> only 
operations defined for const-qualified sequence containers are supported and that the semantics 
of comparison functions are different from those required for a container.
</p></blockquote>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4750">N4750</a>.</p>

<ol>
<li><p>Edit 31.10 <a href="https://wg21.link/re.results">[re.results]</a> as indicated:</p>
<blockquote>
<p>
-2- The class template <tt>match_results</tt> satisfies the requirements of an allocator-aware container 
and of a sequence container (26.2.1 <a href="https://wg21.link/container.requirements.general">[container.requirements.general]</a>, 26.2.3 <a href="https://wg21.link/sequence.reqmts">[sequence.reqmts]</a>) 
except that <ins>besides copy and move assignment</ins> only operations defined for const-qualified 
sequence containers are supported and that the semantics of comparison functions are different from 
those required for a container.
</p>
</blockquote>
</li>
</ol>





</body>
</html>
